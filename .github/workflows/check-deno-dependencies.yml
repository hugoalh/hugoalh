# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json
name: "Check Deno Dependencies (Reusable Workflow)"
on:
  workflow_call:
jobs:
  main:
    name: "Main"
    runs-on: "ubuntu-latest"
    steps:
      - name: "Setup Deno"
        uses: "denoland/setup-deno@v1.1.2"
        with:
          deno-version: "^1.36.0"
      - name: "Checkout Repository"
        uses: "actions/checkout@v3.5.3"
      - name: "Verify Deno Dependencies"
        run: |
          deno vendor mod.ts
      - name: "Check Deno Dependencies Update"
        run: |
          [RegEx]$DenoVendorPathRegEx = "^$(Join-Path -Path $Env:GITHUB_WORKSPACE -ChildPath 'vendor')"
          Get-ChildItem -LiteralPath $Env:GITHUB_WORKSPACE -Include @('*.[jt]s') -Recurse -File |
            Where-Object -FilterScript { $_.FullName -inotmatch $DenoVendorPathRegEx } |
            ForEach-Object -Process {
              deno run --allow-net --allow-read="$Env:GITHUB_WORKSPACE" --no-prompt https://deno.land/x/udd/main.ts --dry-run $_.FullName
            }
        shell: "pwsh"
